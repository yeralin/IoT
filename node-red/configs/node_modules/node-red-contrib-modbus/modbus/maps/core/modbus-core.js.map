{"version":3,"sources":["core/modbus-core.js"],"names":["require","install","de","biancoroyal","modbus","core","internalDebug","ObjectID","getObjectId","getOriginalMessage","messageList","msg","origMsg","messageId","payload","functionCodeModbusRead","dataType","functionCodeModbusWrite","buildMessage","values","response","this","topic","responseBuffer","input","rawMsg","Object","assign","module","exports"],"mappings":"AAOA,aACAA,QAAQ,sBAAsBC,UAE9B,IAAIC,GAAKA,IAAM,CAAEC,YAAa,CAAEC,OAAQ,CAAEC,KAAM,MAAhDH,GAAAC,YAAeC,OAAAC,KAAAC,cAAAJ,GAAAC,YAAAC,OAAAC,KAAAC,eAAAN,QAAA,QAAAA,CAAA,sBAAEG,GAAAA,YAAaC,OAAAC,KAAAE,SAAAL,GAAAC,YAAAC,OAAAC,KAAAE,UAAAP,QAAA,QAAAO,SAAYF,GAAAA,YAAMD,OAAAC,KAAAG,YAAA,WAAR,OAAA,IAAAN,GAAAC,YAAAC,OAAAC,KAAAE,UAQxCL,GAAGC,YAAYC,OAAOC,KAAKI,mBAAqB,SAAUC,EAAaC,GAPrE,IAACR,EAAYC,EAAYE,IAAAA,EAAAA,QAAgBJ,WAUzC,OATCC,GAAYC,EAAOC,UAUbK,EAAW,OAAQE,EAAQC,YARjCV,KAAAA,cAAmBE,iEAA+BO,EAAAC,YAYjDX,GAAGC,YAAYC,OAAOC,KAAKC,cAAc,qBAAuBK,EAAIG,QAAQD,WAR7EV,EAAHQ,GAGMC,GAGDV,GAAAC,YAAAC,OAAAC,KAAAU,uBAAA,SAAAC,GACF,OAAMA,GACLd,IAAGC,OACHS,OAAO,EACR,IAAA,QAUG,OAAO,EARX,IAAOA,kBAZT,OAAA,EAuBI,IAAK,gBARNT,OAAAA,EACD,QACE,OAAK,IAGHD,GAAAC,YAAAC,OAAAC,KAAAY,wBAAA,SAAAD,GAWJ,OAAQA,GAVN,IAAK,OACH,OAAO,EAYT,IAAK,kBAXL,OAAK,EACH,IAAA,SAaA,OAAO,GAZT,IAAA,oBACE,OAAO,GAVX,QADF,OAAA,IAiBId,GAAAC,YAAAC,OAAAC,KAAAa,aAAA,SAAAR,EAAAS,EAAAC,EAAAT,GACE,IAAAC,EAAAS,KAAAZ,mBAAAC,EAAAC,GAcJC,EAAQE,QAAUK,EAbhBP,EAAKU,MAAAX,EAAAW,MACHV,EAAAW,eAAAH,EAeJR,EAAQY,MAAQb,EAbZ,IAAAc,EAAAC,OAAAC,OAAA,GAAAf,GAGF,OAaFa,EAAOX,QAAUM,EAffK,EAAKN,OAAAA,SACHM,EAAAF,eACF,CAAAX,EAAAa,IAGHG,OAbDC,QAAA3B,GAAAC,YAAAC,OAAAC","file":"../../core/modbus-core.js","sourcesContent":["/**\n Copyright (c) 2016,2017,2018,2019 Klaus Landsdorf (https://bianco-royal.com/)\n All rights reserved.\n node-red-contrib-modbus\n\n @author <a href=\"mailto:klaus.landsdorf@bianco-royal.de\">Klaus Landsdorf</a> (Bianco Royal)\n */\n'use strict'\nrequire('source-map-support').install()\n\nvar de = de || { biancoroyal: { modbus: { core: {} } } } // eslint-disable-line no-use-before-define\nde.biancoroyal.modbus.core.internalDebug = de.biancoroyal.modbus.core.internalDebug || require('debug')('contribModbus:core') // eslint-disable-line no-use-before-define\nde.biancoroyal.modbus.core.ObjectID = de.biancoroyal.modbus.core.ObjectID || require('bson').ObjectID // eslint-disable-line no-use-before-define\n\nde.biancoroyal.modbus.core.getObjectId = function () {\n  return new de.biancoroyal.modbus.core.ObjectID()\n}\n\nde.biancoroyal.modbus.core.getOriginalMessage = function (messageList, msg) {\n  let origMsg = messageList.get(msg.payload.messageId)\n\n  if (origMsg && origMsg.messageId) {\n    if (!messageList.delete(origMsg.messageId)) {\n      this.internalDebug('WARNING: getOriginalMessage could not delete message from map ' + origMsg.messageId)\n    }\n  } else {\n    de.biancoroyal.modbus.core.internalDebug('Message Not Found ' + msg.payload.messageId)\n    origMsg = msg\n  }\n\n  return origMsg\n}\n\nde.biancoroyal.modbus.core.functionCodeModbusRead = function (dataType) {\n  switch (dataType) {\n    case 'Coil':\n      return 1\n    case 'Input':\n      return 2\n    case 'HoldingRegister':\n      return 3\n    case 'InputRegister':\n      return 4\n    default:\n      return -1\n  }\n}\n\nde.biancoroyal.modbus.core.functionCodeModbusWrite = function (dataType) {\n  switch (dataType) {\n    case 'Coil':\n      return 5\n    case 'HoldingRegister':\n      return 6\n    case 'MCoils':\n      return 15\n    case 'MHoldingRegisters':\n      return 16\n    default:\n      return -1\n  }\n}\n\nde.biancoroyal.modbus.core.buildMessage = function (messageList, values, response, msg) {\n  const origMsg = this.getOriginalMessage(messageList, msg)\n  origMsg.payload = values\n  origMsg.topic = msg.topic\n  origMsg.responseBuffer = response\n  origMsg.input = msg\n\n  const rawMsg = Object.assign({}, origMsg)\n  rawMsg.payload = response\n  rawMsg.values = values\n  delete rawMsg.responseBuffer\n\n  return [origMsg, rawMsg]\n}\n\nmodule.exports = de.biancoroyal.modbus.core\n"]}